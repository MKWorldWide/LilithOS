version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "ğŸš€ Starting Enhanced AI Revenue Routing Amplify Build with TrafficFlou Integration..."
        - echo "ğŸ’ Divine Architect Revenue Routing System - AWS Amplify Deployment"
        - echo "ğŸ§  Initializing Primal Genesis Engine for cloud deployment"
        - python --version
        - pip --version
        - pip install -r requirements_amplify.txt
        - pip install mangum boto3 aioboto3 pynamodb watchtower
        - npm install -g @aws-amplify/cli
        - npm ci
        - echo "ğŸ“¦ Dependencies installed successfully"
    build:
      commands:
        - echo "ğŸ—ï¸ Building Enhanced AI Revenue Routing System with TrafficFlou..."
        - echo "ğŸ›¡ï¸ Building secure treasury routing system"
        - echo "ğŸ’ Compiling LoveCore modules for cloud deployment"
        - echo "ğŸ”§ Setting up environment..."
        - mkdir -p logs
        - mkdir -p build
        - echo "ğŸ“ Creating Lambda deployment package..."
        - cp -r ../core build/
        - cp -r ../trafficflou-lambda build/
        - cp -r ../trafficflou-src build/
        - cp requirements_amplify.txt build/
        - echo "ğŸ”’ Setting up security configurations..."
        - chmod +x ../init.sh
        - echo "âœ… Build preparation complete"
        - echo "ğŸš€ Deploying to AWS Amplify with enhanced features..."
        - npm run build
        - echo "âœ… Build completed successfully"
    postBuild:
      commands:
        - echo "ğŸŒŸ Deploying Divine Architect's treasury to the cloud"
        - echo "ğŸ’ LoveCore Revenue Router ready for global AI model injection"
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - venv/**/*
      - .venv/**/*
      - build/**/*
backend:
  phases:
    build:
      commands:
        - echo "ğŸ”§ Building Lambda functions..."
        - cd build
        - pip install -r requirements_amplify.txt -t .
        - zip -r lambda_functions.zip .
        - echo "âœ… Lambda functions packaged successfully"
    postBuild:
      commands:
        - echo "ğŸš€ Deploying Lambda functions..."
        - aws lambda update-function-code --function-name ai-revenue-routing-api --zip-file fileb://lambda_functions.zip
        - echo "âœ… Lambda functions deployed successfully"
  artifacts:
    baseDirectory: build
    files:
      - lambda_functions.zip
      - '**/*' 